"use strict";angular.module("app",["ngAnimate","ngResource","ngSanitize","ngRoute","RequestContext","angularLoad","angularMoment","angularSpinner","touk.promisedLink","touk.jwl.ngFnQueue","touk.jwl.history","touk.jwl.page","ng.deviceDetector","main.module","directives.googleMaps","cordova.Ready","ngCordova.plugins.geolocation","ngCordova.plugins.camera","config.vars","app.templates"]).config(["$routeProvider","$locationProvider",function(t,e){return t.when("/votings",{action:"votings"}).when("/voting",{action:"voting"}).when("/voting/:date",{action:"voting"}).when("/wards",{action:"wards"}).when("/wards/:date",{action:"wards"}).when("/wards/:community/:no",{action:"ward"}).when("/wards/:community/:no/ballots",{action:"ward"}).when("/wards/:community/:no/ballots/:ballot",{action:"ward.ballot"}).when("/wards/:community/:no/ballots/:ballot/photos",{action:"ward.ballot.photos"}).when("/wards/:community/:no/ballots/:ballot/share",{action:"ward.ballot.share"}).otherwise({redirectTo:"/wards"}),e.html5Mode(!1)}]).config(["$httpProvider",function(t){return t.defaults.useXDomain=!0,t.interceptors.push(["$q","$location","varsConfig",function(e,n,o){return{request:function(e){var n,r;return angular.extend(e.headers,{"ctrl-pkw-client-version":o.version}),(r=e.transformResponse)?angular.isArray(r)||(r=[r]):(n=t.defaults.transformResponse,angular.isArray(n)||(r=[n])),r.unshift(function(t,e,n){return 403===n&&window.location.replace(e().location),t}),e.transformResponse=r,e}}}])}]).config(["usSpinnerConfigProvider",function(t){return t.setDefaults({color:"black",hwaccel:!0,lines:12,length:12,width:5,radius:15,corners:1})}]).run(["amMoment",function(t){return t.changeLocale("pl"),FastClick.attach(document.body)}]),angular.module("config.vars",[]).constant("varsConfig",{api:"http://ctrlpkw.pl/api",cloudinary:"https://api.cloudinary.com/v1_1",googleMaps:"https://maps.googleapis.com/maps/api",mapsApiKey:"AIzaSyD9ZdOYFEhmyyMWWc7fMQRaV8xKsKWnijw",cloudName:"ddj4jx8rq",version:"0.0.1"});var MapController,__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("directives.googleMaps",["cordova.plugin.googleMaps"]).directive("map",["$q","$document",function(){return{restrict:"AE",controller:"mapController",controllerAs:"ctrl",scope:{markers:"=",centerMapFn:"=",getMapCenterFn:"=",onInit:"=",onMarkerClick:"=",masked:"=",image:"="},link:function(t,e,n,o){return o.init(e[0]),t.$watch("masked",function(n){var r,i;if(null!=(null!=(r=o.Map)?r.getImage:void 0))return n?o.Map.getImage(o.map).then(function(n){return t.image={url:n,height:e.parent()[0].clientHeight,width:e.parent()[0].clientWidth}}):null!=(i=t.image)?i.url=null:void 0})}}}]).service("mapData",[function(){}]).controller("mapController",["initMaps","$injector","$scope","$q","$cordovaGeolocation","locationMonitor","$document","mapData",MapController=function(){function t(t,e,n,o,r,i,a,s){this.initMaps=t,this.injector=e,this.scope=n,this.q=o,this.geolocation=r,this.locationMonitor=i,this.document=a,this.savedMapData=s,this.destructor=__bind(this.destructor,this),this.resizeHandler=__bind(this.resizeHandler,this),this.onMarkerClick=__bind(this.onMarkerClick,this),this.createMarker=__bind(this.createMarker,this),this.removeMarker=__bind(this.removeMarker,this),this.cleanMarkers=__bind(this.cleanMarkers,this),this.getView=__bind(this.getView,this),this.markersChanged=__bind(this.markersChanged,this),this.centerOnMarkers=__bind(this.centerOnMarkers,this),this.doCenterOnMarkers=__bind(this.doCenterOnMarkers,this),this.createCircleForPoints=__bind(this.createCircleForPoints,this),this.centerOnLocation=__bind(this.centerOnLocation,this),this._doCenterOnLocation=__bind(this._doCenterOnLocation,this),this.onInit=__bind(this.onInit,this),this._createMap=__bind(this._createMap,this),this._injectPlugin=__bind(this._injectPlugin,this),this.init=__bind(this.init,this),angular.extend(this.scope,{centerMapFn:this.centerOnLocation,getMapCenterFn:this.getView}),this.scope.$on("$destroy",this.destructor)}return t.prototype.init=function(t){return this._injectPlugin().then(function(e){return function(){return e.map=e._createMap(t),e.map}}(this)).then(function(t){return function(){return t.onInit()}}(this))},t.prototype._injectPlugin=function(){return this.q.when(this.initMaps).then(function(t){return function(e){return t.Map=e}}(this))["catch"](function(){return function(t){return alert(t)}}(this))},t.prototype._createMap=function(t){return this.Map.getMap(t,{center:this.Map.latLng(52,21),zoom:5})},t.prototype.onInit=function(){return setTimeout(function(t){return function(){var e,n;return t.scope.$watch("markers",t.markersChanged,!0),t.resizeHandler(),t.savedMapData.coords?(e=t.Map.latLng(t.savedMapData.coords.latitude,t.savedMapData.coords.longitude),t.map.setZoom(t.savedMapData.zoom),t.Map.moveTo(t.map,e)):t.centerOnLocation(!0),t.scope.$on("MAP_VIEW_CHANGE",function(){return t.getView().then(function(e){return angular.extend(t.savedMapData,e)})}),"function"==typeof(n=t.scope).onInit?n.onInit():void 0}}(this),250)},t.prototype._doCenterOnLocation=function(){return _.debounce(function(t){return function(e,n){var o;return o=t.Map.latLng(e.coords.latitude,e.coords.longitude),t.Map[n?"moveTo":"panTo"](t.map,o)}}(this),250)},t.prototype.centerOnLocation=function(t){return null==this.doCenterOnLocation&&(this.doCenterOnLocation=this._doCenterOnLocation()),this.locationMonitor.lastPosition?this.doCenterOnLocation(this.locationMonitor.lastPosition,t):this.geolocation.getCurrentPosition().then(function(e){return function(n){return e.doCenterOnLocation(n,t)}}(this))},t.prototype.createCircleForPoints=function(t,e){var n,o,r,i,a,s,u;for(n={lat:t.coords.latitude,lng:t.coords.longitude},a=t.coords.radius,s=0,u=e.length;u>s;s++)r=e[s],i={lat:("function"==typeof r.lat?r.lat():void 0)||r.lat,lng:("function"==typeof r.lng?r.lng():void 0)||r.lng},o=this.Map.distance(n,i),a=Math.max(o,a);return this.Map.createCircle(this.map,{center:this.Map.latLng(n.lat,n.lng),radius:a,fillColor:"rgba(0,0,0,0)",strokeColor:"rgba(255, 0, 0, 0.5)",strokeWeight:2})},t.prototype.doCenterOnMarkers=function(t){var e,n,o;return this.resizeHandler(),o=this.Map.latLng(t.coords.latitude,t.coords.longitude),this.Map.deleteCircle(this.viewCircle),n=function(){var t,n,o,r;for(o=this.markers,r=[],t=0,n=o.length;n>t;t++)e=o[t],r.push(this.Map.getMarkerPositon(e));return r}.call(this),this.q.all(n).then(function(e){return function(n){return e.createCircleForPoints(t,n).then(function(t){var r;return n.push(o),r=e.Map.latLngBounds(n),e.viewCircle=t,setTimeout(function(){return e.resizeHandler(),e.savedMapData.coords?(o=e.Map.latLng(e.savedMapData.coords.latitude,e.savedMapData.coords.longitude),e.map.setZoom(e.savedMapData.zoom),e.Map.moveTo(e.map,o)):e.Map.fitBounds(e.map,r)},150)})}}(this))},t.prototype.centerOnMarkers=function(t){return this.markers?t?this.doCenterOnMarkers(t):this.getView().then(this.doCenterOnMarkers):void 0},t.prototype.markersChanged=function(t){var e,n,o;if(null!=t&&(this.cleanMarkers(),null!=(o=t.points)?o.length:void 0))return n=function(){var n,o,r,i;for(r=t.points,i=[],n=0,o=r.length;o>n;n++)e=r[n],i.push(this.createMarker(e));return i}.call(this),this.q.all(n).then(function(e){return function(n){return e.markers=n,e.centerOnMarkers(t.center),e.markers}}(this))},t.prototype.getView=function(){return this.Map.getView(this.map)},t.prototype.cleanMarkers=function(){var t,e,n,o,r,i,a;if(null!=(r=this.markers)?r.length:void 0){if(null!=this.map.clear)return this.map.clear(),void this.map.off();for(i=this.markers,a=[],t=n=0,o=i.length;o>n;t=++n)e=i[t],this.removeMarker(e),a.push(delete this.markers[t]);return a}},t.prototype.removeMarker=function(t){return this.Map.deleteMarker(t)},t.prototype.createMarker=function(t){var e,n,o,r;return console.log("createMarker"),(null!=(r=t.wards)?r.length:void 0)>1&&(e=t.wards.length),_.every(t.wards,{protocolStatus:"LACK"})||(o=.75),n=this.Map.createMarker(this.map,{position:this.Map.latLng(t.location.latitude,t.location.longitude),icon:{url:"img/marker"+(e||"")+".png",size:{width:22*(o||1),height:40*(o||1)}}}),n.then(function(e){return function(n){return e.Map.onMarkerClick(n,function(){return e.onMarkerClick(t)})}}(this)),n},t.prototype.onMarkerClick=function(t){return this.scope.onMarkerClick(t)},t.prototype.resizeHandler=function(){return this.Map.resize(this.map)},t.prototype.destructor=function(){return this.getView().then(function(t){return function(e){return angular.extend(t.savedMapData,e),t.cleanMarkers()}}(this))},t}()]);var BallotController,__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("main.controllers.ballot",["RequestContext","main.resources.cloudinary"]).controller("BallotController",["$scope","RenderContextFactory","ApplicationData","$cordovaCamera","CloudinaryResources","$location","$history",BallotController=function(){function t(t,e,n,o,r,i,a){var s;this.scope=t,this.data=n,this.camera=o,this.cloudinary=r,this.location=i,this.history=a,this.takePhoto=__bind(this.takePhoto,this),this.sendResult=__bind(this.sendResult,this),this.sum=__bind(this.sum,this),this.init=__bind(this.init,this),s=new e(this.scope,"ward.ballot",["community","no","ballot"]),this.scope.$watch(function(t){return function(){return t.ballotNo}}(this),function(t){return function(){return t.ballot=_.find(t.data.ballots,{no:t.ballotNo})}}(this)),this.scope.$on("requestContextChanged",function(t){return function(){return s.isChangeRelevant()?t.init(s):void 0}}(this)),this.images=[],this.result={votesCountPerOption:[]},this.init(s)}return t.prototype.init=function(t){return this.communityCode=t.getParam("community"),this.wardNo=t.getParam("no"),this.ballotNo=t.getParamAsInt("ballot"),this.history.replace()},t.prototype.sum=function(){return _.reduce(this.result.votesCountPerOption,function(t,e){return(t||0)+(e||0)})},t.prototype.sendResult=function(){return this.loading=!0,this.request=this.data.saveProtocol({ballotNo:this.ballot.no,communityCode:this.communityCode,wardNo:this.wardNo,ballotResult:this.result}),this.request.$promise.then(function(t){return function(e){return t.uploadParams=e}}(this))["finally"](function(t){return function(){return t.loading=!1}}(this)),this.request.$promise},t.prototype.takePhoto=function(t){return this.camera.getPicture({destinationType:Camera.DestinationType.DATA_URL,sourceType:t?Camera.PictureSourceType.PHOTOLIBRARY:Camera.PictureSourceType.CAMERA,correctOrientation:!0,saveToPhotoAlbum:!0,quality:49}).then(function(t){return function(e){var n;return t.loading=!0,n={},n.res=t.cloudinary.save({api_key:t.uploadParams.apiKey,timestamp:t.uploadParams.timestamp,signature:t.uploadParams.signature,public_id:t.uploadParams.publicId,file:"data:image/jpeg;base64,"+e}),n.res.$promise["finally"](function(){return t.loading=!1}),n.src="data:image/jpeg;base64,"+e,t.images.push(n)}}(this))},t}()]),angular.module("main.controllers.main",["RequestContext"]).controller("MainCtrl",["$scope","$route","$routeParams","requestContext","ApplicationData",function(t,e,n,o,r){var i,a;return a=o.getRenderContext(),i=function(t){return!t.current.action},t.subview=a.getNextSection(),t.$on("requestContextChanged",function(){return a.isChangeRelevant()?t.subview=a.getNextSection():void 0}),t.$on("$routeChangeSuccess",function(){return i(e)?void 0:(o.setContext(e.current.action,n),t.$broadcast("requestContextChanged",o))}),this.data=r}]);var VotingController,__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("main.controllers.voting",["RequestContext"]).controller("VotingController",["$scope","RenderContextFactory","ApplicationData","$cordovaGeolocation","locationMonitor","$location","$timeout","$history","$page",VotingController=function(){function t(t,e,n,o,r,i,a,s,u){var c;this.scope=t,this.data=n,this.cordovaGeolocation=o,this.locationMonitor=r,this.location=i,this.timeout=a,this.history=s,this.page=u,this.onMarkerClick=__bind(this.onMarkerClick,this),this.updateWards=__bind(this.updateWards,this),this.init=__bind(this.init,this),this.contextChanged=__bind(this.contextChanged,this),c=new e(this.scope,"voting","date"),this.scope.$on("requestContextChanged",function(t){return function(){return c.isChangeRelevant()?t.contextChanged(c):void 0}}(this)),this.contextChanged(c)}return t.prototype.contextChanged=function(t){var e;return this.data.selectedWards=[],(e=t.getParam("date"))?this.data.selectedVoting=e:this.data.votings.$promise.then(function(t){return function(){return t.history.replace(),t.location.replace(),t.location.path("/voting/"+t.data.selectedVoting)}}(this))},t.prototype.init=function(){return this.data.wards.length||this.updateWards(),this.page.title="Lokale wyborcze"},t.prototype.updateWards=function(){return this.data.clearMapData(),"function"==typeof this.getMapCenter?this.getMapCenter().then(this.data.getWards):void 0},t.prototype.onMarkerClick=function(t){return this.data.selectedWards=t.wards,this.scope.$apply(function(t){return function(){return t.location.path("/wards")}}(this))},t}()]);var VotingsController;angular.module("main.controllers.votings",["RequestContext"]).controller("VotingsController",["$scope","RenderContextFactory","ApplicationData","$page",VotingsController=function(){function t(t,e,n,o){var r;this.scope=t,this.data=n,r=new e(this.scope,"votings"),o.title="Wybory"}return t}()]);var WardController,__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("main.controllers.ward",["RequestContext","main.resources.cloudinary","main.controllers.ballot"]).controller("WardController",["$scope","RenderContextFactory","ApplicationData","$cordovaCamera","CloudinaryResources","$location","$history","$page",WardController=function(){function t(t,e,n,o,r,i,a,s){var u;this.scope=t,this.data=n,this.camera=o,this.cloudinary=r,this.location=i,this.history=a,this.page=s,this.init=__bind(this.init,this),this.openBallot=__bind(this.openBallot,this),u=new e(this.scope,"ward",["community","no"]),this.scope.$watch(function(t){return function(){return t.wardNo}}(this),function(t){return function(){return t.ward=_.find(t.data.selectedWards,{no:t.wardNo})}}(this)),this.scope.$on("requestContextChanged",function(t){return function(){return u.isChangeRelevant()?t.init(u):void 0}}(this)),this.init(u),1===this.data.ballots.length&&(this.history.replace(),this.location.replace(),this.openBallot(this.data.ballots[0]))}return t.prototype.openBallot=function(t){return this.location.path("/wards/"+this.communityCode+"/"+this.wardNo+"/ballots/"+t.no)},t.prototype.init=function(t){return this.communityCode=t.getParamAsInt("community"),this.wardNo=t.getParamAsInt("no"),this.page.title="Komisja nr "+this.wardNo},t}()]);var WardsController,__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("main.controllers.wards",["RequestContext"]).controller("WardsController",["$scope","$page","RenderContextFactory","ApplicationData","$cordovaGeolocation","locationMonitor","$location","$history","$timeout",WardsController=function(){function t(t,e,n,o,r,i,a,s,u){var c;this.scope=t,this.data=o,this.cordovaGeolocation=r,this.locationMonitor=i,this.location=a,this.history=s,this.timeout=u,this.getWards=__bind(this.getWards,this),this.init=__bind(this.init,this),this.contextChanged=__bind(this.contextChanged,this),e.title="Lokale wyborcze",c=new n(this.scope,"wards","date"),this.scope.$on("requestContextChanged",function(t){return function(){return c.isChangeRelevant()?t.contextChanged(c):void 0}}(this)),this.contextChanged(c)}return t.prototype.contextChanged=function(t){var e;return(e=t.getParam("date"))?(this.data.selectedVoting=e,this.init()):this.data.votings.$promise.then(function(t){return function(){return t.history.replace(),t.location.replace(),t.location.path("/wards/"+t.data.selectedVoting)}}(this))},t.prototype.init=function(){return this.timeout(function(t){return function(){var e,n;return(null!=(n=t.data.selectedWards)?n.length:void 0)||(t.data.wards.length?t.data.selectedWards=t.data.wards:(t.scope.$watch(function(){return t.data.wards},function(e){return null!=e?t.data.selectedWards=e:void 0}),t.timeout(function(){return t.getWards()},250))),1===t.data.selectedWards.length?(e=t.data.selectedWards[0],t.history.replace(),t.location.replace(),t.location.path("/wards/"+e.communityCode+"/"+e.no)):void 0}}(this))},t.prototype.getWards=function(){var t;return this.locationPending=!0,(null!=(t=this.locationMonitor)?t.lastPosition:void 0)?(this.data.getWards(this.locationMonitor.lastPosition),this.locationPending=!1):this.cordovaGeolocation.getCurrentPosition().then(this.data.getWards)["finally"](function(t){return function(){return t.locationPending=!1}}(this))},t}()]);var ApplicationData,DEBOUNCE_TIMEOUT,MAX_RADIUS,__bind=function(t,e){return function(){return t.apply(e,arguments)}};MAX_RADIUS=5e3,DEBOUNCE_TIMEOUT=250,angular.module("main.data",[]).service("ApplicationData",["$rootScope","VotingsResources","ProtocolsResources","mapData",ApplicationData=function(){function t(t,e,n,o){this.votingsResources=e,this.protocolsResources=n,this.mapSavedData=o,this.currentVoting=__bind(this.currentVoting,this),this.saveProtocol=__bind(this.saveProtocol,this),this.getBallots=__bind(this.getBallots,this),this.getVotings=__bind(this.getVotings,this),this._getWards=__bind(this._getWards,this),this.clearMapData=__bind(this.clearMapData,this),this._onVotingChanged=__bind(this._onVotingChanged,this),this.getWards=_.debounce(this._getWards,DEBOUNCE_TIMEOUT),this.getVotings(),t.$watch(function(t){return function(){return t.selectedVoting}}(this),this._onVotingChanged)}return t.prototype.votings=[],t.prototype.selectedVoting=null,t.prototype.ballots=[],t.prototype.wardsCount=3,t.prototype.wards=[],t.prototype.selectedWards=[],t.prototype.markers=[],t.prototype._onVotingChanged=function(){return this.wards=[],this.selectedWards=[],this.markers=[],this.clearMapData(),this.selectedVoting?this.getBallots():void 0},t.prototype.clearMapData=function(){return this.mapSavedData.bounds=null,this.mapSavedData.coords=null,this.mapSavedData.zoom=null},t.prototype._getWards=function(t){var e;return this.wardsLoading=!0,this.selectedWards=[],t.coords.radius=Math.min(MAX_RADIUS,t.coords.radius/2||0),e=this.votingsResources.getWards({date:this.selectedVoting,minCount:this.wardsCount,latitude:t.coords.latitude,longitude:t.coords.longitude,radius:t.coords.radius}),e.$promise.then(function(e){return function(n){var o;return e.wards=n,e.wards.length?(o=_.chain(e.wards).groupBy(function(t){return[t.location.latitude,t.location.longitude]}).map(function(t){return{location:t[0].location,wards:t}}).value(),e.markers={points:o,center:t}):void 0}}(this))["finally"](function(t){return function(){return t.wardsLoading=!1}}(this)),e.$promise},t.prototype.getVotings=function(){return this.votings=this.votingsResources.getVotings(),this.votings.$promise.then(function(t){return function(){return null!=t.selectedVoting?t.selectedVoting:t.selectedVoting=t.votings[0].date}}(this))},t.prototype.getBallots=function(){return this.ballots=this.votingsResources.getBallots({date:this.selectedVoting})},t.prototype.saveProtocol=function(t){return this.protocolsResources.save(angular.extend({votingDate:this.selectedVoting},t))},t.prototype.currentVoting=function(){return null!=this.selectedVoting?_.find(this.votings,{date:this.selectedVoting}):void 0},t}()]),angular.module("main.module",["main.data","main.controllers.main","main.controllers.votings","main.controllers.voting","main.controllers.wards","main.controllers.ward","main.resources.votings"]),angular.module("main.resources.cloudinary",["config.vars"]).factory("CloudinaryResources",["$resource","varsConfig",function(t,e){return t(""+e.cloudinary+"/"+e.cloudName+"/image/upload")}]),angular.module("main.resources.votings",["config.vars"]).factory("VotingsResources",["$resource","varsConfig",function(t,e){return t(""+e.api+"/votings/:date/:action",{date:"@date"},{getVotings:{method:"GET",isArray:!0},getWards:{method:"GET",params:{action:"wards"},isArray:!0},getBallots:{method:"GET",params:{action:"ballots"},isArray:!0}})}]).factory("ProtocolsResources",["$resource","varsConfig",function(t,e){return t(""+e.api+"/protocols/:id",{})}]),angular.module("ngCordova.plugins.camera",["cordova.Ready"]).factory("$cordovaCamera",["$q","crdReady",function(t,e){return{getPicture:function(n){var o;return o=t.defer(),e(function(){return navigator.camera?navigator.camera.getPicture(function(t){return o.resolve(t)},function(t){return o.reject(t)},n):(o.resolve(null),o.promise)})(),o.promise},cleanup:function(){var n;return n=t.defer(),e(function(){return navigator.camera.cleanup(function(){return n.resolve()},function(t){return n.reject(t)})})(),n.promise}}}]),angular.module("cordova.Ready",["touk.jwl.ngFnQueue"]).factory("crdReady",["$q","$document","fnQueue",function(t,e,n){var o;return o=t.defer(),e.one("deviceready",function(){return o.resolve()}),n(o.promise)}]);var LocationMonitor,__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("ngCordova.plugins.geolocation",["cordova.Ready"]).factory("$cordovaGeolocation",["$q","crdReady",function(t,e){return{getCurrentPosition:function(n){var o;return o=t.defer(),e(function(){return navigator.geolocation.getCurrentPosition(function(t){return o.resolve(t)},function(t){return o.reject(t)},n)})(),o.promise},watchPosition:function(n){var o;return o=t.defer(),e(function(){var t;return t=navigator.geolocation.watchPosition(function(t){return o.notify(t)},function(t){return o.reject(t)},n),o.promise.cancel=function(){return navigator.geolocation.clearWatch(t)},o.promise.clearWatch=function(e){return navigator.geolocation.clearWatch(e||t)},o.promise.watchID=t})(),o.promise},clearWatch:function(t){return e(function(){return navigator.geolocation.clearWatch(t)})()}}}]).service("locationMonitor",["$q","$rootScope","$cordovaGeolocation","$document",LocationMonitor=function(){function t(t,e,n,o){this.q=t,this.rootScope=e,this.geolocation=n,this.document=o,this.stop=__bind(this.stop,this),this.start=__bind(this.start,this),this.document.on("resume",this.start).on("pause",this.stop),this.start()}return t.prototype.promise=null,t.prototype.lastPosition=null,t.prototype.start=function(){return this.stop(),this.promise=this.geolocation.watchPosition().then(null,null,function(t){return function(e){return t.lastPosition=e,t.rootScope.$broadcast("LOCATION_CHANGED",t.lastPosition),t.document.triggerHandler("location_changed")}}(this))},t.prototype.stop=function(){var t;return null!=(t=this.promise)&&"function"==typeof t.cancel&&t.cancel(),this.promise=null},t}()]);var GoogleMapsJS,GoogleMapsNative,Maps,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};Maps=function(){function t(){this.distance=__bind(this.distance,this)}return t.prototype.EARTH_RADIUS=6370986,t.prototype.toRad=function(t){return t*Math.PI/180},t.prototype.distance=function(t,e){var n,o,r,i,a,s,u,c;return a=this.toRad(t.lat),u=this.toRad(t.lng),s=this.toRad(e.lat),c=this.toRad(e.lng),i=c-u,r=s-a,n=Math.pow(Math.sin(r/2),2)+Math.cos(a)*Math.cos(s)*Math.pow(Math.sin(i/2),2),o=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),this.EARTH_RADIUS*o},t}(),angular.module("cordova.plugin.googleMaps",["cordova.Ready","config.vars"]).factory("initMaps",["$q","$injector","crdReady","varsConfig",function(t,e,n,o){var r,i,a,s,u,c;return a=t.defer(),i=n(function(){var t,e;return console.debug("checkNative"),("undefined"!=typeof plugin&&null!==plugin&&null!=(t=plugin.google)&&null!=(e=t.maps)?e.Map:void 0)?plugin.google.maps.Map.isAvailable(function(t){return t?u():r()}):r()}),r=function(){var t,e,n,r,i;return console.debug("checkJavascript"),("undefined"!=typeof google&&null!==google&&null!=(i=google.maps)?i.Map:void 0)?s():(t="mapsInit",window[t]=function(){return s(),clearTimeout(n),delete window[t]},n=setTimeout(function(){return c(),delete window[t]},1e4),r=""+o.googleMaps+"/js?key="+o.mapsApiKey,e=document.createElement("script"),e.type="text/javascript",e.src=""+r+"&callback="+t,document.body.appendChild(e))},u=function(){return console.debug("nativeMaps"),a.resolve(e.get("googleMapsNative"))},s=function(){return console.debug("javascriptMaps"),a.resolve(e.get("googleMapsJS"))},c=function(){return console.debug("noMaps"),a.reject("No maps")},i(),a.promise}]).service("googleMapsNative",["$q","$rootScope",GoogleMapsNative=function(t){function e(t,e){this.q=t,this.rootScope=e,this.onMarkerClick=__bind(this.onMarkerClick,this),this.radius=__bind(this.radius,this),this.getView=__bind(this.getView,this),this.getImage=__bind(this.getImage,this),this.resize=__bind(this.resize,this),this.deleteCircle=__bind(this.deleteCircle,this),this.createCircle=__bind(this.createCircle,this),this.getMarkerPositon=__bind(this.getMarkerPositon,this),this.createMarker=__bind(this.createMarker,this),this._onMapCameraChanged=__bind(this._onMapCameraChanged,this)}return __extends(e,t),e.prototype.getMap=function(t,e){var n,o;return o=angular.element(t).css({display:"none"}).parent()[0],n=plugin.google.maps.Map.getMap(o,{backgroundColor:e.backgroundColor,controls:{zoom:!1,compass:!0,myLocation:!0,myLocationButton:!1},camera:{latLng:e.center,tilt:e.tilt,zoom:e.zoom,bearing:e.bearing}}),n.on(plugin.google.maps.event.CAMERA_CHANGE,this._onMapCameraChanged(n)),n},e.prototype._onMapCameraChanged=function(t){return function(e){return function(){return e.getView(t).then(function(t){return e.rootScope.$broadcast("MAP_VIEW_CHANGE",t)})}}(this)},e.prototype.fitBounds=function(t,e){return t.setPadding(60),t.animateCamera({target:e,duration:1e3}),setTimeout(function(){return t.setPadding(0)})},e.prototype.panTo=function(t,e){return t.getCameraPosition(function(n){return t.animateCamera({target:e,zoom:n.zoom,duration:1e3})})},e.prototype.moveTo=function(t,e){return t.getCameraPosition(function(n){return t.moveCamera({target:e,zoom:n.zoom})})},e.prototype.latLng=function(t,e){return new plugin.google.maps.LatLng(t,e)},e.prototype.latLngBounds=function(t){return new plugin.google.maps.LatLngBounds(t)},e.prototype.createMarker=function(t,e){var n;return n=this.q.defer(),e.icon&&(e.icon.url="www/"+e.icon.url),t.addMarker(e,function(t){return n.resolve(t)}),n.promise},e.prototype.getMarkerPositon=function(t){var e;return e=this.q.defer(),null!=t&&t.getPosition(function(t){return e.resolve(t)}),e.promise},e.prototype.deleteMarker=function(t){return null!=t?t.remove():void 0},e.prototype.createCircle=function(t,e){var n,o;return n=this.q.defer(),o=angular.extend({fillColor:"rgba(1,97,248,.2)",radius:10,strokeWidth:e.strokeWeight||0,strokeColor:"rgba(0,0,0,.2)"},e),t.addCircle(o,function(t){return n.resolve(t)}),n.promise},e.prototype.deleteCircle=function(t){return this.deleteMarker(t)},e.prototype.resize=function(t){return null!=t?t.refreshLayout():void 0},e.prototype.getImage=function(t){var e;return e=this.q.defer(),null!=t&&t.toDataURL(function(){return function(t){return e.resolve(t)}}(this)),e.promise},e.prototype.getView=function(t){var e;return e=this.q.defer(),t.getVisibleRegion(function(n){return function(o){return t.getCameraPosition(function(t){var r;return r=o.getCenter(),e.resolve({bounds:o,zoom:t.zoom,coords:{latitude:r.lat,longitude:r.lng,radius:n.radius(o)}})})}}(this)),e.promise},e.prototype.radius=function(t){var e,n,o,r;return e=t.getCenter(),n=t.northeast,o={lat:e.lat,lng:e.lng},r={lat:n.lat,lng:n.lng},this.distance(o,r)},e.prototype.onMarkerClick=function(t,e){return t.addEventListener(plugin.google.maps.event.MARKER_CLICK,e)},e}(Maps)]).service("googleMapsJS",["$q","$cordovaGeolocation","$document","locationMonitor","$rootScope",GoogleMapsJS=function(t){function e(t,e,n,o,r){this.q=t,this.geolocation=e,this.document=n,this.locationMonitor=o,this.rootScope=r,this.onMarkerClick=__bind(this.onMarkerClick,this),this.radius=__bind(this.radius,this),this.getView=__bind(this.getView,this),this.resize=__bind(this.resize,this),this.deleteCircle=__bind(this.deleteCircle,this),this.createCircle=__bind(this.createCircle,this),this.getMarkerPositon=__bind(this.getMarkerPositon,this),this.createMarker=__bind(this.createMarker,this),this.moveTo=__bind(this.moveTo,this),this.panTo=__bind(this.panTo,this),this.fitBounds=__bind(this.fitBounds,this),this._animateCircleResize=__bind(this._animateCircleResize,this),this._animateMarkerMove=__bind(this._animateMarkerMove,this),this._resizeCircle=__bind(this._resizeCircle,this),this._moveMarker=__bind(this._moveMarker,this),this._createLocationChangeHandler=__bind(this._createLocationChangeHandler,this),this._onMapCameraChanged=__bind(this._onMapCameraChanged,this),this.getMap=__bind(this.getMap,this)}return __extends(e,t),e.prototype.getMap=function(t,e){var n;return this.document.off("location_changed",this._locationChangeHandler),angular.extend(e,{disableDefaultUI:!0}),n=new google.maps.Map(t,e),this._locationChangeHandler=this._createLocationChangeHandler(n),this._locationChangeHandler(),this.document.on("location_changed",this._locationChangeHandler),google.maps.event.addListener(n,"center_changed",this._onMapCameraChanged(n)),n},e.prototype._onMapCameraChanged=function(t){return function(e){return function(){return e.getView(t).then(function(t){return e.rootScope.$broadcast("MAP_VIEW_CHANGE",t)})}}(this)},e.prototype._createLocationChangeHandler=function(t){var e,n;return n=null,e=null,function(o){return function(){var r,i,a,s,u;return null!=o.locationMonitor.lastPosition?(a=o.locationMonitor.lastPosition.coords,s=o.latLng(a.latitude,a.longitude),r=a.accuracy,n?(o._animateMarkerMove(n,s),o._animateCircleResize(e,r),o._animateMarkerMove(e,s)):(n={},u=24,i=u/2,o.createMarker(t,{position:s,icon:{url:"img/location.png",scaledSize:new google.maps.Size(u,u),anchor:new google.maps.Point(i,i)}}).then(function(t){return n=t}),e={},o.createCircle(t,{center:s,radius:r}).then(function(t){return e=t}))):void 0}}(this)},e.prototype._moveMarker=function(t,e,n,o){return"function"==typeof t.setPosition&&t.setPosition(e[n]),"function"==typeof t.setCenter&&t.setCenter(e[n]),n!==e.length-1?setTimeout(function(r){return function(){return r._moveMarker(t,e,n+1,o)}}(this),o):void 0},e.prototype._resizeCircle=function(t,e,n,o){return"function"==typeof t.setRadius&&t.setRadius(e[n]),n!==e.length-1?setTimeout(function(r){return function(){return r._resizeCircle(t,e,n+1,o)}}(this),o):void 0},e.prototype._animateMarkerMove=function(t,e){var n,o,r,i,a,s,u;if(t){if(a=[],u=0,s=("function"==typeof t.getPosition?t.getPosition():void 0)||("function"==typeof t.getCenter?t.getCenter():void 0),!s)return;for(n=s.lat(),o=s.lng();1>u;)r=n+u*(e.lat()-n),i=o+u*(e.lng()-o),a.push(this.latLng(r,i)),u+=.01;return this._moveMarker(t,a,0,20)}},e.prototype._animateCircleResize=function(t,e){var n,o,r,i;if(r=[],i=0,n=null!=t&&"function"==typeof t.getRadius?t.getRadius():void 0){for(;1>i;)o=n+i*(e-n),r.push(o),i+=.01;return this._resizeCircle(t,r,0,20)}},e.prototype.fitBounds=function(t,e){return t.fitBounds(e)},e.prototype.panTo=function(t,e){return t.panTo(e)},e.prototype.moveTo=function(t,e){return t.setCenter(e)},e.prototype.latLng=function(t,e){return new google.maps.LatLng(t,e)},e.prototype.latLngBounds=function(t){var e,n,o,r,i;for(e=new google.maps.LatLngBounds(t[0],t[0]),i=t.slice(1),o=0,r=i.length;r>o;o++)n=i[o],n&&e.extend(n);return e},e.prototype.createMarker=function(t,e){var n,o,r,i;return n=this.q.defer(),(null!=(r=e.icon)&&null!=(i=r.size)?i.width:void 0)&&(e.icon.scaledSize=new google.maps.Size(e.icon.size.width,e.icon.size.height),delete e.icon.size),o=new google.maps.Marker(angular.extend({map:t},e)),n.resolve(o),n.promise},e.prototype.getMarkerPositon=function(t){var e;return e=this.q.defer(),t?e.resolve(t.getPosition()):e.reject(),e.promise},e.prototype.deleteMarker=function(t){return null!=t?t.setMap(null):void 0
},e.prototype.createCircle=function(t,e){var n,o,r,i;return n=this.q.defer(),null!=e.fillColor&&(o=new Color(e.fillColor)),null!=e.strokeColor&&(i=new Color(e.strokeColor)),r=angular.extend({map:t,fillColor:(null!=o?o.toRGBString():void 0)||"rgb(1, 97, 248)",fillOpacity:(null!=o?o.alpha:void 0)||.2,radius:10,strokeWeight:0,strokeColor:(null!=i?i.toRGBString():void 0)||"rgb(0, 0, 0)",strokeOpacity:(null!=i?i.alpha:void 0)||.2},e),n.resolve(new google.maps.Circle(r)),n.promise},e.prototype.deleteCircle=function(t){return this.deleteMarker(t)},e.prototype.resize=function(t){return google.maps.event.trigger(t,"resize")},e.prototype.getView=function(t){var e,n,o;return o=this.q.defer(),e=t.getBounds(),n=e.getCenter(),o.resolve({bounds:e,zoom:t.getZoom(),coords:{latitude:n.lat(),longitude:n.lng(),radius:this.radius(e)}}),o.promise},e.prototype.radius=function(t){var e,n,o,r;return e=t.getCenter(),n=t.getNorthEast(),o={lat:e.lat(),lng:e.lng()},r={lat:n.lat(),lng:n.lng()},this.distance(o,r)},e.prototype.onMarkerClick=function(t,e){return google.maps.event.addListener(t,"click",e)},e}(Maps)]);var History,__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("touk.jwl.history",[]).service("$history",["$q","$rootScope","$location",History=function(){function t(t,e,n){this.$q=t,this.$location=n,this.back=__bind(this.back,this),this.clean=__bind(this.clean,this),this.hasPrevious=__bind(this.hasPrevious,this),this.last=__bind(this.last,this),this.replace=__bind(this.replace,this),this.add=__bind(this.add,this),e.$on("$locationChangeSuccess",function(t){return function(){return t.add()}}(this)),angular.extend(e,{history:this}),e.$watch(function(t){return function(){return t.$states}}(this),function(t){return function(){return console.debug("history",t.$states)}}(this),!0)}return t.prototype.$states=[],t.prototype.$replace=!1,t.prototype.add=function(t){return null==t&&(t=this.$location.path()),this.$replace&&(this.$states.pop(),this.$replace=!1),t.length>0&&_.last(this.$states)!==t?this.$states.push(t):void 0},t.prototype.replace=function(){return this.$replace=!0},t.prototype.last=function(){return _.last(this.$states)},t.prototype.hasPrevious=function(){return this.$states.length>1},t.prototype.clean=function(){return this.$replace=!1,this.$states=_.takeRight(this.$states)},t.prototype.back=function(t){return null==t&&(t=1),this.$replace=!1,this.$states.length>1?(this.$states=_.dropRight(this.$states,t),this.$location.replace(),this.$location.path(_.last(this.$states))):void 0},t}()]).run(["$history","$timeout",function(t,e){return document.addEventListener("backbutton",function(n){return n.preventDefault(),e(function(){return function(){var e;return t.back()||("undefined"!=typeof navigator&&null!==navigator&&null!=(e=navigator.app)&&"function"==typeof e.exitApp?e.exitApp():void 0)}}(this))},!1)}]);var Page;angular.module("touk.jwl.page",[]).service("$page",["$rootScope","$timeout",Page=function(){function t(t,e){this.$timeout=e,t.page=this}return t.prototype.title="",t}()]).run(["$page",function(){}]);